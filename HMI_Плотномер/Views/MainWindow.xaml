<Window x:Class="IDensity.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"               
        xmlns:vm="clr-namespace:IDensity.ViewModels"
        xmlns:pages="clr-namespace:IDensity.Core.Views.Pages"
        xmlns:oxy="http://oxyplot.org/wpf" xmlns:col1="clr-namespace:System.Collections;assembly=System.Runtime.Extensions" xmlns:sys1="clr-namespace:System;assembly=System.Runtime"
        xmlns:wpftool="http://schemas.xceed.com/wpf/xaml/toolkit"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        
        xmlns:add="clr-namespace:IDensity.AddClasses"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:uc="clr-namespace:IDensity.Views.Resourses.UserControls"
        xmlns:adc="clr-namespace:IDensity.Views.Resourses.UserControls.AdcControls"
        xmlns:sett="clr-namespace:IDensity.AddClasses.Settings"
        xmlns:dt="clr-namespace:IDensity.Core.Views.UserControls.DateTimes"
        mc:Ignorable="d"  
        Background="#000000"
        Title="MainWindow" Height="450" Width="800" WindowState="Maximized">    
    <Window.DataContext>
        <vm:VM/>
    </Window.DataContext>    
        <!--#region Страницы -->
        <Grid>
            <!--#region High Bar -->
            <pages:HighBar/>
            <!--#endregion-->
            <!--#region Вкладки -->
        <TabControl  Grid.Row="1" TabStripPlacement="Bottom" >
            <!--#region Вкладка Измерение -->
            <TabItem Header="Измерение"
                             Tag="..\Pictures\MeasIcon.png"
                             Name="MainTab" 
                             IsSelected="{Binding CurUser.Level, Mode=OneWay, Converter={StaticResource NotEqual}, ConverterParameter={x:Static sys1:String.Empty}}">
                <pages:MainPage/>
            </TabItem>
            <!--#endregion-->
            <!--#region Вкладка Настройки -->
            <TabItem Header="Настройки"
                             Tag="..\Pictures\TuneIcon.png">
                <pages:SettingsPage/>
            </TabItem>
            <!--#endregion-->
            <!--#region НАСТРОЙКИ -->
            <TabItem Header="НАСТРОЙКИ" Visibility="{Binding CurUser, Converter={StaticResource UserToVisibility}, ConverterParameter=Сервис}">
                
                <TabControl TabStripPlacement="Left" Template="{StaticResource TabControlHorizontalScroll}">                   
                   
                    <!--#region Сохранить json -->
                    <TabItem Header="SAVE-LOAD JSON" Visibility="{Binding CurUser, Converter={StaticResource UserToVisibility}, ConverterParameter=Администратор}">
                        <uc:SaveLoadMainModelControl DataContext="{Binding CommonSettingsVm}"/>
                    </TabItem>
                    <!--#endregion-->
                </TabControl>
            </TabItem>
            <!--#endregion-->
            <!--#region Управление -->
            <TabItem Header="УПРАВЛЕНИЕ" Visibility="{Binding CurUser, Converter={StaticResource UserToVisibility}, ConverterParameter=Сервис}">
                <adc:SpectrTuneControl DataContext="{Binding AdcViewModel}"/>
            </TabItem>
            <!--#endregion-->
            <!--#region События -->
            <TabItem Header="СОБЫТИЯ">
                <TabControl TabStripPlacement="Top">
                    <TabItem Header="ВСЕ СОБЫТИЯ">
                        <Grid>
                            <Grid.Resources>
                                <CollectionViewSource x:Key="EventsCollection" Source="{Binding HistoryEventItems}"/>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <!--#region Панель фильтров -->
                            <Grid Grid.Row="0">
                                <UniformGrid Columns="5">
                                    <dt:DateTimeParameter Description="Начальная точка событий"
                                                          DateTimeWidth="200"
                                                          Margin="2"
                                                          DateTime="{Binding StartPointHistoryEvent, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <dt:DateTimeParameter Description="Конечная точка событий"
                                                          DateTimeWidth="200"                                              
                                                          Margin="2"
                                                          DateTime="{Binding EndPointHistoryEvent, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <Button Margin="2"
                                                        VerticalContentAlignment="Center"
                                                        Command="{Binding ShowEventsCommand}"
                                                       >
                                        <Button.Content>
                                            <StackPanel Orientation="Horizontal">
                                                <fa:ImageAwesome Width="20" 
                                                                             Icon="Refresh" 
                                                                             Foreground="AliceBlue" 
                                                                             Spin="{Binding HistoryItemDownloading}" 
                                                                             Visibility="{Binding HistoryItemDownloading, Converter={StaticResource VisibleConverter}}"/>
                                                <TextBlock Text="Показать" VerticalAlignment="Center"
                                                                       HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>
                                    <Border Margin="2" Style="{StaticResource BorderLight}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition/>
                                                <ColumnDefinition Width="0.1*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox HorizontalContentAlignment="Left"
                                                                 VerticalContentAlignment="Center"
                                                                 Text="{Binding EventFilterText, UpdateSourceTrigger=PropertyChanged}"/>
                                            <fa:ImageAwesome Grid.Column="1" Icon="Search" Width="20" Foreground="AliceBlue"/>
                                        </Grid>
                                    </Border>
                                </UniformGrid>
                            </Grid>
                            <!--#endregion-->
                            <!--#region Таблица всех событий -->
                            <DataGrid Grid.Row="1" 
                                                  IsReadOnly="True" 
                                                  AutoGenerateColumns="False" 
                                                  ItemsSource="{Binding SelectedEventItems}" 
                                                  VirtualizingPanel.VirtualizationMode="Recycling"
                                                  CanUserAddRows="False" 
                                                  CanUserDeleteRows="False">
                                <DataGrid.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel/>
                                    </ItemsPanelTemplate>
                                </DataGrid.ItemsPanel>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource EventRowStyle}"/>
                                </DataGrid.RowStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Время возникновения ошибки" Binding="{Binding EventTime, StringFormat=F,ConverterCulture=ru-RU}"/>
                                    <DataGridTextColumn Header="Пользователь" Binding="{Binding UserName}"/>
                                    <DataGridTextColumn Header="Код события" Binding="{Binding Event.Num, StringFormat=d4}"/>
                                    <DataGridTextColumn Header="Сообщение" Binding="{Binding Event.Title}"/>
                                    <DataGridTextColumn Header="Активность" Binding="{Binding Activity, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource Activities}}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <!--#endregion-->
                        </Grid>
                    </TabItem>
                    <TabItem Header="ОШИБКИ">
                        <ListView ItemsSource="{Binding Events.EventDevices}">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Background" Value="{Binding ActiveBrush}"/>
                                    <Setter Property="Visibility" Value="{Binding IsActive, Converter={StaticResource VisibleConverter}}"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Номер" DisplayMemberBinding="{Binding Num, StringFormat=d4}"/>
                                    <GridViewColumn Header="Сообщение" DisplayMemberBinding="{Binding Title}"/>
                                    <GridViewColumn Header="Время" DisplayMemberBinding="{Binding LastExecDate}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </TabItem>
                </TabControl>

            </TabItem>

            <!--#endregion-->
        </TabControl>
        <Grid.RowDefinitions>
                <RowDefinition Height="0.08*" ></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>
            <!--#endregion-->        
    </Grid>
        <!--#endregion-->   
</Window>
