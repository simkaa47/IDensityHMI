<Window x:Class="IDensity.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"               
        xmlns:vm="clr-namespace:IDensity.ViewModels"       
        xmlns:oxy="http://oxyplot.org/wpf" xmlns:col1="clr-namespace:System.Collections;assembly=System.Runtime.Extensions" xmlns:sys1="clr-namespace:System;assembly=System.Runtime"
        xmlns:wpftool="http://schemas.xceed.com/wpf/xaml/toolkit"
        xmlns:fa="http://schemas.fontawesome.io/icons/"        
        xmlns:add="clr-namespace:IDensity.AddClasses"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:uc="clr-namespace:IDensity.Views.Resourses.UserControls"    
        xmlns:sett="clr-namespace:IDensity.AddClasses.Settings"
        mc:Ignorable="d"         
        Title="MainWindow" Height="450" Width="800"
        Background="DarkSlateGray">
    <Window.Resources>
        
    </Window.Resources>
    <Window.DataContext>
        <vm:VM/>
    </Window.DataContext>
    
    <!--#region Страницы -->
    <Grid>
        <!--#region Верхний бар -->
        <Grid>
            <Grid.Resources>
                <Style TargetType="Border" BasedOn="{StaticResource BorderLight}"/>
                <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
            </Grid.Resources>
            <Grid.ColumnDefinitions>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition Width="0.4*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <!--#region Эмблема заказчика -->
            <Border Grid.Column="0" Margin="5">
                <TextBlock Text="Место для эмблемы заказчика" VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="Wrap"></TextBlock>
            </Border>
            <!--#endregion-->
            <!--#region Серийный номер -->
            <Border Grid.Column="1"  Margin="5">
                <UniformGrid Rows="2">
                    <TextBlock Text="Серийный номер:" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
                    <TextBlock Text="000000" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
                </UniformGrid>
            </Border>
            <!--#endregion-->
            <!--#region Индикатор связи с платой -->
            <Border Background="{Binding mainModel.Connecting.Value, Converter={StaticResource ColorToBool}}"  Grid.Column="2" Margin="5">
                <TextBlock Text="Связь с платой" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
            </Border>
            <!--#endregion-->
            <!--#region Индикатор измерений -->
            <Border Grid.Column="3" Margin="5" Background="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource ColorToBool}}">               
                <TextBox Text="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource measStatus}}"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Center"></TextBox>
            </Border>
            <!--#endregion-->
            <!--#region Индикатор высокого напряжения -->
            <Border Grid.Column="4" Margin="5" Background="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource ColorToBool}}">                
                <TextBox Text="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource hvStatus}}"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Center"
                         HorizontalContentAlignment="Center"></TextBox>
            </Border>
            <!--#endregion-->
            <!--#region Время и пользователь -->
            <Border Grid.Column="5" Margin="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="0.2*"/>
                    </Grid.ColumnDefinitions>
                    <!--#region RTC -->
                    <Viewbox Grid.ColumnSpan="2"  >
                        <TextBlock Text="{Binding mainModel.Rtc.Value, StringFormat=F,   UpdateSourceTrigger=PropertyChanged, ConverterCulture=ru-RU,  Mode=OneWay}"/>
                    </Viewbox>
                    <!--#endregion-->
                    <!--#region Авторизация -->
                    <Button Grid.Row="1" Margin="2"  MouseDoubleClick="Logout_click" HorizontalContentAlignment="Stretch">
                        <Button.ToolTip>Авторизация</Button.ToolTip>
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="User" HorizontalAlignment="Left" Margin="5,1,10,1"/>
                            <TextBlock Text="{Binding CurUser, Converter={StaticResource UserToName} }" VerticalAlignment="Center"  HorizontalAlignment="Stretch">
                            </TextBlock>
                        </StackPanel>
                    </Button>
                    <!--#endregion-->
                    <!--#region Логаут -->
                    <Button Grid.Column="1" Command="{Binding LogoutCommand}" Grid.Row="1" Margin="2">
                        <fa:ImageAwesome Icon="Reply"/>
                    </Button>
                    <!--#endregion-->
                </Grid>
            </Border>
            <!--#endregion-->
            <!--#region Кнопка закрыть приложение -->
            <Button Grid.Column="6" Margin="5" Command="{Binding CloseAppCommand}">
                <Button.ToolTip>Закрыть приложение</Button.ToolTip>
                <fa:ImageAwesome Icon="TimesCircle"/>
            </Button>
            <!--#endregion-->
        </Grid>
        <!--#endregion-->
        <!--#region Вкладки -->
        <TabControl  Grid.Row="1" TabStripPlacement="Bottom" >
            <!--#region Вкладка управление -->
            <TabItem Header="УПРАВЛЕНИЕ">
                <TabItem.Resources>
                    <ResourceDictionary>
                        <ResourceDictionary.MergedDictionaries>
                            <ResourceDictionary Source="Resourses/Templates/Trends.xaml"/>
                        </ResourceDictionary.MergedDictionaries>
                    </ResourceDictionary>
                </TabItem.Resources>
                <Grid>
                    <!--#region Развбивка на 4 части экрана -->
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="1.5*"></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <!--#endregion-->

                    <!--#region Тренды -->
                    <TabControl TabStripPlacement="Bottom">
                        <!--#region Текущй тренд -->
                        <TabItem Header="Текущий тренд">
                            <!--#region Текущий тренд -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="0.1*"></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition></ColumnDefinition>
                                    <ColumnDefinition></ColumnDefinition>
                                    <ColumnDefinition></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <DockPanel Grid.Column="0" >
                                    <CheckBox x:Name="VisibleLine1" IsChecked="True"  VerticalAlignment="Center"></CheckBox>
                                    <Label Content="Усредненная физическая величина"  VerticalAlignment="Center"></Label>
                                </DockPanel>
                                <DockPanel Grid.Column="1">
                                    <CheckBox x:Name="VisibleLine2" VerticalAlignment="Center"></CheckBox>
                                    <Label Content="Мгновенная физическая величина"  VerticalAlignment="Center"></Label>
                                </DockPanel>
                                <oxy:Plot Grid.Row="2" Grid.ColumnSpan="4" Tag="{Binding PlotCollection}" Template="{StaticResource Trend}"></oxy:Plot>
                            </Grid>
                            <!--#endregion-->
                        </TabItem>
                        <!--#endregion-->
                        <!--#region Настройки отображения -->
                        <TabItem Header="Настройки отображения">
                            <ListBox HorizontalContentAlignment="Stretch">
                                <!--#region Временоой интервал -->
                                <ListBoxItem Template="{StaticResource TextBoxParameter}" Tag="Максимальное время отображения, мин" 
                                             Content="{Binding TrendSettings.PlotTime, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Минимальный предел -->
                                <ListBoxItem Template="{StaticResource TextBoxParameterFloat}" Tag="Минимальный предел" 
                                             Content="{Binding TrendSettings.PlotLowLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Мксимальный предел -->
                                <ListBoxItem Template="{StaticResource TextBoxParameterFloat}" Tag="Максимальный предел" 
                                             Content="{Binding TrendSettings.PlotHighLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                </ListBoxItem>
                                <!--#endregion-->                                
                            </ListBox>
                        </TabItem>
                        <!--#endregion-->
                        <!--#region Архивный тренд -->
                        <TabItem Header="Архивный тренд">
                            <Grid>
                                <Grid.Resources>
                                    <Style TargetType="Border" BasedOn="{StaticResource BorderLight}"/>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
                                </Grid.Resources>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="0.1*"/>
                                    <RowDefinition Height="0.1*"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <!--#region Тренд -->
                                <oxy:Plot  Grid.Row="2" Grid.ColumnSpan="6" Tag="{Binding ArchivalDataPotnts}" Template="{StaticResource Trend}"></oxy:Plot>
                                <fa:ImageAwesome Grid.Row="2" Spin="{Binding ArchivalTrendDownloading}" Visibility="{Binding ArchivalTrendDownloading, Converter={StaticResource VisibleConverter}}"    Grid.ColumnSpan="6" Height="30"   Icon="Refresh" />
                                <!--#endregion-->
                                <!--#region Стартовая точка тренда -->
                                <uc:DateTimeParameter Grid.ColumnSpan="2"
                                                      Description="Стартовая точка тренда"
                                                      PopupOpenedCommand="{Binding SelectDatesCommand}"
                                                      DateTimeWidth="180"
                                                      DateTime="{Binding DisplayDateStart, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>                               
                                <!--#endregion-->
                                <!--#region Конечная точка тренда -->
                                <uc:DateTimeParameter Grid.Column="2"
                                                      Grid.ColumnSpan="2"
                                                      PopupOpenedCommand="{Binding SelectDatesCommand}"
                                                      Description="Конечная точка тренда"
                                                      DateTimeWidth="180"
                                                      DateTime="{Binding DisplayDateEnd, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                <!--#endregion-->
                                <!--#region Кнопка "Показать тренд" -->
                                <Button Grid.Column="4" Margin="2" Command="{Binding ShowArchivalTrendCommand}">
                                    <TextBlock  Text="Показать тренд" TextWrapping="Wrap"></TextBlock>
                                </Button>
                                <!--#endregion-->
                                <!--#region Путь к файлу -->
                                <Border Grid.Row="1" Grid.ColumnSpan="3" Margin="2">
                                    <TextBlock x:Name="LogPath" Text="{Binding LogPath, Mode=TwoWay}" VerticalAlignment="Center"></TextBlock>
                                </Border>
                                <!--#endregion-->
                                <!--#region Кнопка Browse -->
                                <Button Grid.Row="1" Click="BrowseLogPath" Grid.Column="3" Margin="2">
                                    <DockPanel>
                                        <fa:ImageAwesome Icon="FolderOutlinepenOutline" Margin="2"/>
                                        <TextBlock Text="Browse" Margin="2" VerticalAlignment="Center" HorizontalAlignment="Center"></TextBlock>
                                    </DockPanel>
                                </Button>
                                <!--#endregion-->
                                <!--#region Кнопка "Запись" -->
                                <Button Grid.Row="1" 
                                        Command="{Binding WriteLogCommand}" 
                                        HorizontalContentAlignment="Stretch" 
                                        Grid.Column="4" Margin="2" 
                                        IsEnabled="{Binding LogPath, Converter={StaticResource FileExistConverter}}">
                                    <DockPanel>
                                        <fa:ImageAwesome 
                                            Margin="2" 
                                            Visibility="{Binding ArchivalTrendUploading, Converter={StaticResource VisibleConverter}}" 
                                            Icon="Refresh" HorizontalAlignment="Center"                                             
                                            Spin="{Binding ArchivalTrendUploading}"/>
                                        <TextBlock Text="Запись" 
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"/>
                                    </DockPanel>
                                </Button>
                                <!--#endregion-->

                            </Grid>
                        </TabItem>
                        <!--#endregion-->
                    </TabControl>
                    <!--#endregion-->

                    <!--#region Числовая индикация ФВ -->
                    <ListBox ItemsSource="{Binding mainModel.MeasResults}"
                             Grid.Column="1"
                             HorizontalContentAlignment="Stretch"
                             VerticalContentAlignment="Stretch"
                             Grid.RowSpan="2">
                        
                    </ListBox>
                        
                    <!--#endregion-->                    

                    <!--#region Кнопки управления -->
                    <Grid Grid.Row="1" Grid.Column="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition></ColumnDefinition>
                            <ColumnDefinition></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>                        
                        <!--#region Кнопка Вкл-выкл измерения -->
                        <Button Grid.Column="0" 
                                Grid.ColumnSpan="2" 
                                Margin="5" 
                                Command="{Binding SwitchMeasCommand}" 
                                Background="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource ColorToBool}, ConverterParameter=#FF6A5AcD}">

                            <TextBlock  Text="{Binding mainModel.CycleMeasStatus.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource measStatusBtn}}"
                                       IsEnabled="{Binding mainModel.Connecting}"
                                       TextWrapping="Wrap"/>
                        </Button>
                        <!--#endregion-->
                    </Grid>
                    <!--#endregion-->                    

                </Grid>
            </TabItem> 
            <!--#endregion-->
            <!--#region Вкладка настроек -->
            <TabItem Header="НАСТРОЙКИ">
                <TabControl TabStripPlacement="Left">
                    <TabItem Header="КОММУНИКАЦИЯ">
                        <Grid>
                            <ListBox HorizontalContentAlignment="Stretch" >
                                <!--#region Способ связи с платой -->
                                <GroupBox  Header="Способ связи с платой">
                                    <StackPanel>
                                        <RadioButton GroupName="comm"  IsChecked="{Binding mainModel.CommMode.RsEnable}"  Content="RS-485(Modbus RTU)"/>
                                        <RadioButton GroupName="comm"  IsChecked="{Binding mainModel.CommMode.EthEnable}" Content="Ethernet (TCP)"/>
                                        <RadioButton GroupName="comm"  IsChecked="{Binding mainModel.CommMode.HartEnable}" Content="HART"  IsEnabled="False"/>
                                    </StackPanel>
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Параметры RS485 -->
                                <GroupBox  Header="Настройки RS-485" HorizontalAlignment="Stretch">
                                    <!--#region Параметры RS485 -->
                                    <ListBox>
                                        <!--#region Имя COM порта -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Имя COM порта" HorizontalAlignment="Left"></TextBlock>
                                                <ComboBox Width="80" HorizontalAlignment="Right" ItemsSource="{Binding ComPorts}" SelectedItem="{Binding mainModel.rs.ComName}">
                                                    <i:Interaction.Triggers>
                                                        <i:EventTrigger EventName="DropDownOpened">
                                                            <i:InvokeCommandAction Command="{Binding UpdateComPortListCommand}"/>
                                                        </i:EventTrigger>
                                                    </i:Interaction.Triggers>
                                                </ComboBox>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->                                        
                                        <!--#region Скорость передачи даных, бит/c -->                                        
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Скорость передачи даных, бит/c" HorizontalAlignment="Left"></TextBlock>
                                                <ComboBox  Width="80"   ItemsSource="{StaticResource PortSpeedsInt}"  SelectedItem="{Binding mainModel.rs.BaudRate}"  HorizontalAlignment="Right"/>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Паритет-->                                        
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Паритет" HorizontalAlignment="Left"></TextBlock>
                                                <ComboBox    Width="80"  ItemsSource="{StaticResource parityes}"    SelectedItem="{Binding mainModel.rs.Par}" HorizontalAlignment="Right"></ComboBox>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Адрес устройства в сети Modbus -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <Grid>
                                                <TextBlock Style="{StaticResource Common}" Text="Адрес устройства в сети Modbus" HorizontalAlignment="Left"></TextBlock>
                                                <TextBox Text="{Binding mainModel.rs.MbAddr}" HorizontalContentAlignment="Center" Width="80" HorizontalAlignment="Right"></TextBox>
                                            </Grid>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                    </ListBox>
                                    <!--#endregion-->
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Параметры  Ethernet-->
                                <GroupBox Header="Настройки Ethernet(TCP) соединения">
                                    <ListBox HorizontalContentAlignment="Stretch">
                                        <ListBoxItem Content="{Binding mainModel.Tcp.IP, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"  HorizontalAlignment="Stretch" Template="{StaticResource TextBoxParameter}"  Tag="IP адрес устройства"></ListBoxItem>
                                        <ListBoxItem Content="{Binding mainModel.Tcp.PortNum, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" HorizontalAlignment="Stretch" Template="{StaticResource TextBoxParameter}"  Tag="Номер порта"></ListBoxItem>
                                    </ListBox>
                                </GroupBox>
                                <!--#endregion-->
                                <!--#region Настройки последовательного порта плотномера -->
                                <GroupBox Header="Настройки последовательного порта плотномера">
                                    <ListBox HorizontalContentAlignment="Stretch">
                                        <!--#region Баудрейт -->
                                        <ListBoxItem DataContext="{Binding mainModel.PortBaudrate}">
                                            <uc:CompoboxParameter CompoboxWidth="80"
                                                                  ItemSource="{StaticResource PortSpeeds}"
                                                                  SelectedItem="{Binding Value, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                                  Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeBaudrateCommand}"
                                                                  CommanDParameter="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem}"/>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Режим работы -->
                                        <ListBoxItem DataContext="{Binding mainModel.PortSelectMode}">
                                            <uc:CompoboxParameter CompoboxWidth="80"
                                                                  ItemSource="{StaticResource PortModes}"
                                                                  Index="{Binding Value}"
                                                                  Command="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}, Path=DataContext.ChangeSerialSelectCommand}"
                                                                  CommanDParameter="{Binding RelativeSource={RelativeSource Self}, Path=Index}"/>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                    </ListBox>
                                </GroupBox>
                                <!--#endregion-->
                            </ListBox>
                        </Grid>
                    </TabItem>                    
                    <TabItem Header="ДАТА И ВРЕМЯ">
                        <Grid>
                            <Grid.Resources>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                
                            </Grid.RowDefinitions>
                           
                        </Grid>                       
                    </TabItem>
                </TabControl>
            </TabItem>
            <!--#endregion-->
            <!--#region Расширенные настройки -->
            <TabItem Header="РАСШИРЕННЫЕ НАСТРОЙКИ">
                <TabItem.Resources>
                    <!--#region Общий стиль для DaraGrid -->
                    <Style TargetType="DataGrid">
                        <Setter Property="VerticalGridLinesBrush" Value="DarkGray"/>
                        <Setter Property="GridLinesVisibility" Value="Vertical"/>
                        <Setter Property="AlternatingRowBackground" Value="AliceBlue"/>
                        <Setter Property="AutoGenerateColumns" Value="False"/>
                    </Style>
                    <!--#endregion-->
                </TabItem.Resources>
                <TabControl TabStripPlacement="Left">
                    <TabItem Header="ИЗМЕРИТЕЛЬНЫЕ ПРОЦЕССЫ">
                        <TabControl TabStripPlacement="Top"
                                    ContentTemplate="{StaticResource TabItemMeasProc}"
                                    ItemsSource="{Binding mainModel.MeasProcSettings}">
                            <TabControl.ItemContainerStyle>
                                <Style TargetType="TabItem"  BasedOn="{StaticResource MeasProcTabItemStyle}">
                                    <Setter Property="Header" Value="{Binding Num}"/>
                                    <Setter Property="HeaderStringFormat" Value="Процесс №{0}"/>
                                    <Setter Property="Tag" Value="{Binding IsActive.WriteValue}"/>
                                </Style>
                            </TabControl.ItemContainerStyle>
                            
                            
                        </TabControl>
                    </TabItem>
                    <!--#region Калибровка -->
                    <TabItem Header="КАЛИБРОВКА">
                        <ScrollViewer>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="300"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <GroupBox Header="Единичное измерение">
                                    <ListBox>
                                        <!--#region Время еденичного измерения, секунд -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <DockPanel>
                                                <TextBlock Text="Время еденичного измерения, секунд"
                                                       Style="{StaticResource Common}"/>
                                                <TextBox Width="80"
                                                     Text="{Binding SingleMeasTime}"
                                                     HorizontalAlignment="Right"
                                                     VerticalContentAlignment="Center"
                                                     HorizontalContentAlignment="Center"/>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Степень полинома  -->
                                        <ListBoxItem  HorizontalContentAlignment="Stretch">
                                            <DockPanel>
                                                <TextBlock Text="Степень полинома"
                                                       Style="{StaticResource Common}"/>
                                                <TextBox Width="80"
                                                     HorizontalAlignment="Right"
                                                     HorizontalContentAlignment="Center"
                                                     Text="{Binding CalibrationClass.PolDegree}"/>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region ФВ -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <DockPanel>
                                                <TextBlock Text="Физическая величина образца, "
                                                       Style="{StaticResource Common}"/>
                                                <TextBlock Style="{StaticResource Common}">
                                                    <TextBlock.Text>
                                                        <MultiBinding Converter="{StaticResource StringByIndex}">
                                                            <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.CurMeasNum" Mode="OneWay"/>
                                                            <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.MeasUnits" Mode="OneWay"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                                <TextBox Width="80"
                                                     HorizontalAlignment="Right"
                                                     HorizontalContentAlignment="Center"
                                                     VerticalContentAlignment="Center"
                                                     Text="{Binding SingleMeasPhysValue}"/>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region "Управление еденичным измерением" -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <DockPanel>
                                                <TextBlock Text="Управление еденичным измерением"
                                                       VerticalAlignment="Center"
                                                   Style="{StaticResource Common}"/>
                                                <Button Width="200"
                                                    Height="Auto"
                                                    HorizontalAlignment="Right"
                                                    Command="{Binding MakeSingleMeasCommand}">
                                                    <TextBlock Text="{Binding SingelMeasFlag, 
                                                    Converter={StaticResource StatusFromNum}, 
                                                    ConverterParameter={StaticResource SingleMeasures}}"
                                                           TextWrapping="Wrap"/>
                                                </Button>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Осталось времени ед. измерения -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch"
                                                 Visibility="{Binding SingelMeasFlag, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <DockPanel>
                                                <TextBlock Text="Осталось времени еденичного измерения, секунд"
                                                       Style="{StaticResource Common}"/>
                                                <TextBlock Text="{Binding SingleMeasCurTime}"
                                                       Style="{StaticResource Common}"
                                                       HorizontalAlignment="Right"/>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Результат счетчика -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <DockPanel>
                                                <TextBlock Text="Результат, каунтов"
                                                       Style="{StaticResource Common}"/>
                                                <TextBlock Text="{Binding SingleMeasCounterResult, UpdateSourceTrigger=PropertyChanged}"
                                                       HorizontalAlignment="Right"
                                                       Style="{StaticResource Common}"/>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->
                                        <!--#region Результат ослабление -->
                                        <ListBoxItem HorizontalContentAlignment="Stretch">
                                            <DockPanel>
                                                <TextBlock Text="Вычисленное ослабление"
                                                       Style="{StaticResource Common}"/>
                                                <TextBlock Text="{Binding SingleMeasWeakResult, UpdateSourceTrigger=PropertyChanged}"
                                                       HorizontalAlignment="Right"
                                                       Style="{StaticResource Common}"/>
                                            </DockPanel>
                                        </ListBoxItem>
                                        <!--#endregion-->

                                    </ListBox>
                                </GroupBox>
                                <!--#region Таблица результатов еденичного измерения -->
                                <GroupBox Grid.Row="1"
                                      Header="Таблица результатов еденичного измерения">
                                    <StackPanel>
                                        <DataGrid AutoGenerateColumns="False"
                                              ItemsSource="{Binding CalibrationClass.SingleMeasCells.Data}">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Физическая величина" Binding="{Binding PhysVal}"/>
                                                <DataGridTextColumn Header="Значение ослабления" Binding="{Binding Weak}"/>
                                            </DataGrid.Columns>

                                        </DataGrid>
                                        <UniformGrid Columns="3">
                                            <Button Margin="5"
                                                Command="{Binding GetCalibrCoeffsCommand}"
                                                Content="Рассчитать к-ты"/>
                                            <Button Margin="5"
                                                Content="Загрузить к-ты в память контроллера"
                                                    Command="{Binding SetCalibrCoeffsCommand}"/>
                                            <ToggleButton Style="{StaticResource MaterialDesignRaisedButton}" Margin="5"
                                                    Content="Показать график зависимости"
                                                          Command="{Binding ShowPolinomTrendCommand}"
                                                          Name="PopupOpen">                                                
                                            </ToggleButton>
                                            
                                        </UniformGrid>
                                        <Popup IsOpen="{Binding ElementName=PopupOpen, Path=IsChecked}" 
                                               StaysOpen="False"
                                               Placement="MousePoint">
                                            <Grid>
                                                <Border Style="{StaticResource BorderLight}"
                                                        Height="600"
                                                        Width="800">
                                                    <oxy:Plot TextColor="WhiteSmoke"                                                          
                                                          PlotAreaBorderColor="WhiteSmoke"
                                                          SelectionColor="WhiteSmoke"
                                                          LegendTextColor="WhiteSmoke" 
                                                          IsLegendVisible="True"
                                                          Background="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Background}"
                                                          PlotAreaBackground="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Background}">
                                                        <oxy:Plot.Axes>
                                                            <oxy:LinearAxis Title="Физ. величина"                                                    
                                                                            Position="Left"
                                                                            MajorGridlineColor="WhiteSmoke"
                                                                            MajorGridlineStyle="Dot"/>
                                                            <oxy:LinearAxis Title="Ослабление"
                                                                             MajorGridlineColor="WhiteSmoke"
                                                                            MajorGridlineStyle="Dot"
                                                                            Position="Bottom"/>
                                                        </oxy:Plot.Axes>
                                                        <oxy:LineSeries    ItemsSource="{Binding MeasuredPointsCollection}"
                                                                       DataFieldX="X" DataFieldY="Y"
                                                                       Title="Измереннные точки"
                                                                       Color="Red"/>
                                                        <oxy:LineSeries    ItemsSource="{Binding CalculatedMeasCollection}"
                                                                       DataFieldX="X" DataFieldY="Y"
                                                                       Title="Кривая по полиному"
                                                                       Color="Blue"/>

                                                    </oxy:Plot>
                                                </Border>
                                                
                                            </Grid>
                                        </Popup>
                                        <!--#region Расчитанные к-ты -->
                                        <DataGrid ItemsSource="{Binding CalculatedCoeffs}">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Степень полинома" Binding="{Binding Deegry}" IsReadOnly="True"/>
                                                <DataGridTextColumn Header="Коэффициент" Binding="{Binding Coeff}"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                        <!--#endregion-->
                                    </StackPanel>
                                </GroupBox>
                                <!--#endregion-->
                            </Grid>
                        </ScrollViewer>                       

                    </TabItem>
                    <!--#endregion-->                    
                    <!--#region Настройки платы HV -->
                    <TabItem Header="ПЛАТА HV" >
                        <ListBox HorizontalContentAlignment="Stretch" >
                            <!--#region Уставка напряжения -->                           
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.VoltageSV}">
                                <uc:Parameter Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.SetHvCommand}" />
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Входное напряжение -->
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.VoltageCurIn}">
                                <uc:Parameter/>
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Выходное напряжение -->
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.VoltageCurOut}">
                                <uc:Parameter/>
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Индикатор связи -->
                            <ListBoxItem DataContext="{Binding mainModel.TelemetryHV.HvCommState}">
                                <UserControl Template="{StaticResource BitIndicator}"/>
                            </ListBoxItem>
                            <!--#endregion-->
                            <!--#region Кнопка включения-выключения HV -->
                            <ListBoxItem>
                                <DockPanel>                                    
                                    <TextBlock Style="{StaticResource Common}" 
                                               Text="Управление Высоким напряжением"/>
                                    <Button Width="220" Height="Auto" HorizontalAlignment="Right"
                                            Background="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource ColorToBool}, ConverterParameter=#FFFF0000}"
                                            Command="{Binding SwitchHvCommand}">
                                        <TextBlock TextWrapping="Wrap" 
                                                   Text="{Binding mainModel.TelemetryHV.HvOn.Value, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource HvButn}}"
                                                   ></TextBlock>
                                    </Button>
                                </DockPanel>                                
                            </ListBoxItem>
                            <!--#endregion-->
                        </ListBox>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Плата питания -->
                    <TabItem Header="ПЛАТА ПИТАНИЯ">
                        <ListBox HorizontalContentAlignment="Stretch">
                            <!--#region Температура -->
                            <ListBoxItem DataContext="{Binding mainModel.TempTelemetry.TempInternal}" >
                                <uc:Parameter/>
                            </ListBoxItem>
                            <!--#endregion-->

                            <!--#region Индикатор связи -->
                            <ListBoxItem DataContext="{Binding mainModel.TempTelemetry.TempBoardCommState}">
                                <UserControl Template="{StaticResource BitIndicator}"/>
                            </ListBoxItem>
                            <!--#endregion-->
                        </ListBox>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Плата АЦП -->
                    <TabItem Header="ПЛАТА АЦП" >
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <ListBox>
                                <!--#region Индикатор связи -->
                                <ListBoxItem HorizontalContentAlignment="Stretch">
                                    <UserControl Template="{StaticResource BitIndicator}" DataContext="{Binding mainModel.AdcBoard.CommState}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region IP адрес udp приемника -->
                                <ListBoxItem HorizontalContentAlignment="Stretch">
                                    <DockPanel>
                                        <TextBlock Text="IP адрес приемника данных по UDP"
                                               VerticalAlignment="Center"
                                               Style="{StaticResource Common}"/>
                                        <StackPanel Orientation="Horizontal"
                                                HorizontalAlignment="Right">
                                            <TextBox Text="{Binding mainModel.UdpAddrString, UpdateSourceTrigger=PropertyChanged}"
                                                 MinWidth="100"
                                                 HorizontalContentAlignment="Center"
                                                 VerticalContentAlignment="Center"/>
                                            <Button Width="50"
                                                Margin="5,0,5,0"
                                                Command="{Binding SetUpsAddrCommand}"
                                                Content="-->"/>
                                        </StackPanel>
                                    </DockPanel>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Режим работы АЦП -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding mainModel.AdcBoardSettings.AdcMode}">
                                    <uc:CompoboxParameter ItemSource="{StaticResource AdcModes}"
                                                      Index="{Binding WriteValue, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                      CompoboxWidth="220"
                                                      Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.mainModel.AdcBoardSettings.SetAdcModeChangeCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Режим синхронизации  -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding mainModel.AdcBoardSettings.AdcSyncMode}">
                                    <uc:CompoboxParameter ItemSource="{StaticResource AdcSyncModes}"
                                                      Index="{Binding WriteValue, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                      CompoboxWidth="220"
                                                      Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.mainModel.AdcBoardSettings.SetAdcSyncModeChangeCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Режим обработки при регистрировании максимальных амплитуд  -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" DataContext="{Binding mainModel.AdcBoardSettings.AdcProcMode}">
                                    <uc:CompoboxParameter ItemSource="{StaticResource AdcProcModes}"
                                                      Index="{Binding WriteValue, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                      CompoboxWidth="220"
                                                      Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.mainModel.AdcBoardSettings.SetAdcProcModeChangeCommand}"/>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Уровень синхронизации -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" 
                                         DataContext="{Binding mainModel.AdcBoardSettings.AdcSyncLevel}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.mainModel.AdcBoardSettings.SetAdcSyncLevelChangeCommand}"/>

                                </ListBoxItem>
                                <!--#endregion-->
                                <ListBoxItem HorizontalContentAlignment="Stretch"
                                             DataContext="{Binding mainModel.AdcBoardSettings.PreampGain}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.mainModel.AdcBoardSettings.SetPreampGainChangeCommand}"/>
                                </ListBoxItem>
                                <!--#region Таймнр выдачи данных -->
                                <ListBoxItem HorizontalContentAlignment="Stretch" 
                                         DataContext="{Binding mainModel.AdcBoardSettings.TimerMax}">
                                    <uc:Parameter Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.mainModel.AdcBoardSettings.SetTimerMaxChangeCommand}"/>

                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Запуск/останов платы АЦП -->
                                <ListBoxItem HorizontalContentAlignment="Stretch">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <Button Margin="5,0,5,0"
                                            Command="{Binding StartAdcCommand}"
                                            CommandParameter="1"
                                            Content="Включить плату АЦП"/>
                                        <Button Margin="5,0,5,0"
                                            Command="{Binding StartAdcCommand}"
                                            CommandParameter="0"
                                            Grid.Column="1"
                                            Content="Выключить плату АЦП"/>
                                    </Grid>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Запуск/останов выдачи данных АЦП  -->
                                <ListBoxItem HorizontalContentAlignment="Stretch">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <Button Margin="5,0,5,0"
                                            Command="{Binding StartAdcDataCommand}"
                                            CommandParameter="1"
                                            Content="Старт выдачи данных АЦП"/>
                                        <Button Margin="5,0,5,0"
                                            Command="{Binding StartAdcDataCommand}"
                                            CommandParameter="0"
                                            Grid.Column="1"
                                            Content="Стоп выдачи данных АЦП"/>
                                    </Grid>
                                </ListBoxItem>
                                <!--#endregion-->
                            </ListBox>
                            <!--#region Тренд в режиме осциллографа-->
                            <oxy:Plot PlotMargins="30,0,0,30"  
                                      Visibility="{Binding mainModel.AdcBoardSettings.AdcMode.Value, Converter={StaticResource VisibleIfEqual}, ConverterParameter=0}"
                                      Grid.Row="1"
                                      PlotType="XY"                                         
                                      PlotAreaBorderThickness="0" 
                                      TextColor="WhiteSmoke"                               
                                      Background="DarkSlateGray"   
                                      PlotAreaBackground="DarkGray">

                                <oxy:Plot.Axes>
                                    <oxy:LinearAxis  
                                        TextColor="WhiteSmoke"
                                        FontSize="14"
                                        MajorGridlineColor="WhiteSmoke"
                                        MajorGridlineStyle="Dot"
                                        Position ="Left" />
                                </oxy:Plot.Axes>
                                <oxy:LineSeries  LineStyle="Dash"                                           
                                               ItemsSource="{Binding AdcDataTrend}"
                                               DataFieldX="X" DataFieldY="Y"                                           
                                               Color="Black"/>  
                            </oxy:Plot>
                            <!--#endregion-->
                            <!--#region Гистограмма в режиме максимальных амплитуд -->
                            <oxy:Plot Grid.Row="1"
                                      TextColor="WhiteSmoke"
                                      PlotAreaBorderColor="WhiteSmoke"
                                      SelectionColor="WhiteSmoke"
                                      LegendTextColor="WhiteSmoke"
                                      Visibility="{Binding mainModel.AdcBoardSettings.AdcMode.Value, Converter={StaticResource VisibleIfEqual}, ConverterParameter=1}"
                                      Background="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Background}"
                                      PlotAreaBackground="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=Background}">
                                <oxy:Plot.Axes>
                                    <oxy:LinearAxis Title="Значение"                                                    
                                                    Position="Left"
                                                    AbsoluteMinimum="0"/>
                                    <oxy:LinearAxis Title="Номер" 
                                                    Position="Bottom"
                                                    AbsoluteMinimum="0"/>
                                </oxy:Plot.Axes>
                                <oxy:LinearBarSeries Color="Red"                                                   
                                                     BarWidth="40"
                                                     ItemsSource="{Binding MaxAmplitudesData}"
                                                     DataFieldX="X"
                                                     DataFieldY="Y"/>
                                
                            </oxy:Plot>
                            <!--#endregion-->

                        </Grid>
                                         
                    </TabItem>
                    <!--#endregion-->                    
                    <!--#region Релейный выход -->
                    <TabItem Header="РЕЛЕЙНЫЙ ВЫХОД">
                        <StackPanel>
                            <Button Content="Включить реле" Command="{Binding SwitchRelayCommand}" CommandParameter="1"/>
                            <Button Content="Выключить реле" Command="{Binding SwitchRelayCommand}" CommandParameter="0"/>
                        </StackPanel>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region События -->
                    <TabItem Header="СОБЫТИЯ">
                        <DataGrid ItemsSource="{Binding Events.EventDevices}" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False">
                            <DataGrid.Columns>
                                <!--#region ID -->
                                <DataGridTextColumn Header="Id" Binding="{Binding Id}" IsReadOnly="True"/>
                                <!--#endregion-->
                                <DataGridTextColumn Header="Номер" Binding="{Binding Num, StringFormat=d4}"></DataGridTextColumn>
                                <!--#region Заголовок -->
                                <DataGridTextColumn Header="Заголовок" Binding="{Binding Title}"/>
                                <!--#endregion-->
                                <!--#region Описание события -->
                                <DataGridTextColumn Header="Описание события" Binding="{Binding Description}" />
                                <!--#endregion-->
                                <!--#region Активный фон -->
                                <DataGridTemplateColumn Width="120">
                                    <DataGridTemplateColumn.Header>
                                        <TextBlock Text="Активный фон"
                                                   TextWrapping="Wrap"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <wpftool:ColorPicker SelectedColor="{Binding ActiveColor, UpdateSourceTrigger=LostFocus}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <!--#endregion-->
                                <!--#region Неактивный фон -->
                                <DataGridTemplateColumn Width="120">
                                    <DataGridTemplateColumn.Header>
                                        <TextBlock Text="Неактивный фон"
                                                   TextWrapping="Wrap"/>
                                    </DataGridTemplateColumn.Header>
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <wpftool:ColorPicker SelectedColor="{Binding NotActiveColor, UpdateSourceTrigger=LostFocus}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Тип" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{StaticResource EventTypes}" SelectedIndex="{Binding Type, UpdateSourceTrigger=PropertyChanged}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridCheckBoxColumn Binding="{Binding IsActive, UpdateSourceTrigger=PropertyChanged}"/>
                                <!--#endregion-->
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Управление пользователями -->
                    <TabItem Header="ПОЛЬЗОВАТЕЛИ">
                        <DataGrid  ItemsSource="{Binding Users.Data}">                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Логин" Binding="{Binding Login}"/>
                                <DataGridTextColumn Header="Имя" Binding="{Binding Path=Name}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Фамилия" Binding="{Binding Path=Somename}"></DataGridTextColumn>
                                <DataGridComboBoxColumn Header="Уровень доступа" ItemsSource="{StaticResource users}" SelectedItemBinding="{Binding Path=Level}" ></DataGridComboBoxColumn>
                                <DataGridTextColumn Header="Пароль" Binding="{Binding Password}"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Перечисления -->
                    <TabItem Header="ПЕРЕЧИСЛЕНИЯ">
                        <TabItem.Resources>
                            <!--#region Общий шаблон для таблички -->
                            <ControlTemplate x:Key="Enums">
                                <GroupBox Header="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=Tag}">
                                    <DataGrid ItemsSource="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=DataContext}"   >
                                        <DataGrid.Columns>
                                            <DataGridTextColumn  Header="Id" Binding="{Binding Id}" IsReadOnly="True"></DataGridTextColumn>
                                            <DataGridTextColumn Header="Name" Binding="{Binding Name}"></DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </GroupBox>
                                
                            </ControlTemplate>
                            <!--#endregion-->
                        </TabItem.Resources>
                        <WrapPanel>
                            <!--#region Названия Источников компенсаций -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding MeasTypesNamesNames.Data}" Tag="Типы измерений"></DataGrid>
                            <!--#endregion-->
                            <!--#region Названия Источников компенсаций -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding CompensationSrcNames.Data}" Tag="Источники компенсаций"></DataGrid>
                            <!--#endregion-->
                            <!--#region Названия Типов калибровок -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding TypeCalibrations.Data}" Tag="Типы калибровок"></DataGrid>                            
                            <!--#endregion-->
                            <!--#region Единицы измерения -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding UnitNames.Data}" Tag="Единицы измерения"></DataGrid>
                            <!--#endregion-->
                            <!--#region Тип переменной для аналогового выхода -->
                            <DataGrid Template="{StaticResource Enums}" DataContext="{Binding TypeAnalogOutVars.Data}" Tag="Тип переменной для аналогового выхода"></DataGrid>
                            <!--#endregion-->                            
                        </WrapPanel>
                        
                    </TabItem>
                    <!--#endregion-->
                    <!--#region Параметры -->
                    <TabItem Header="ПАРАМЕТРЫ">
                        <TabItem.Resources>
                            <add:ParamList x:Key="paramsList"/>
                        </TabItem.Resources>
                        <DataGrid ItemsSource="{Binding Source={StaticResource paramsList}, Path=ParameterList}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Id" Binding="{Binding Id}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Описание" Binding="{Binding Description}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Мин. величина" Binding="{Binding MinValue}"></DataGridTextColumn>
                                <DataGridTextColumn Header="Макс. величина" Binding="{Binding MaxValue}"></DataGridTextColumn>                               
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                    <!--#endregion-->
                </TabControl>
            </TabItem>
            <!--#endregion-->
            <!--#region Новые настройки -->
            <TabItem Header="НОВЫЕ НАСТРОЙКИ">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="0.5"/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Menu >
                        <Menu.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel IsItemsHost="True" Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </Menu.ItemsPanel>
                        <!--#region Измерение -->
                        <MenuItem  Header="ИЗМЕРЕНИЕ" FlowDirection="LeftToRight">
                            <MenuItem Header="ИЗМЕРИТЕЛЬНЫЕ ПРОЦЕССЫ" ItemTemplate="{StaticResource MeasProcMenu}"   ItemsSource="{Binding mainModel.MeasProcSettings}"/>
                            <MenuItem Header="Длительность измерения, x0.1 c."  DataContext="{Binding mainModel.MeasProcSettings[0].MeasDuration}">
                                <uc:MenuItemParameterText Command="{Binding Command}"/>
                            </MenuItem>
                            <MenuItem Header="Диапазоны счетчиков" ItemsSource="{Binding mainModel.CountDiapasones}"/>
                        </MenuItem>
                        <!--#endregion-->
                        <!--#region Дата и время -->
                        <MenuItem Header="ДАТА И ВРЕМЯ">
                            <ListBox HorizontalContentAlignment="Stretch">
                                <!--#region Реадктирование rtc -->
                                <ListBoxItem>
                                    <DockPanel>
                                        <TextBlock Text="{Binding mainModel.Rtc.Description}"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <wpftool:DateTimePicker Name="Dt" Value="{Binding mainModel.Rtc.WriteValue}" Margin="1,0,1,0"></wpftool:DateTimePicker>
                                            <Button Command="{Binding SetRtcCommand}" Width="50" Margin="1,0,1,0">--></Button>
                                        </StackPanel>
                                    </DockPanel>
                                </ListBoxItem>
                                <!--#endregion-->
                                <!--#region Синхронизация с временем ПК -->
                                <ListBoxItem>
                                    <DockPanel>
                                        <TextBlock Text="{Binding CurPcDateTime.Description}"></TextBlock>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <TextBlock Margin="1,0,1,0"  Width="{Binding ElementName=Dt, Path=ActualWidth}" 
                                                       Text="{Binding CurPcDateTime.Value, StringFormat=F,   UpdateSourceTrigger=PropertyChanged, ConverterCulture=ru-RU,  Mode=OneWay}"
                                                       HorizontalAlignment="Center"></TextBlock>
                                            <Button Command="{Binding SyncRtcCommand}" Width="50" Margin="1,0,1,0">--></Button>
                                        </StackPanel>
                                    </DockPanel>
                                </ListBoxItem>
                                <!--#endregion-->
                            </ListBox>
                        </MenuItem>
                        <!--#endregion-->
                        <!--#region Аналоговые синалы -->
                        <MenuItem  Header="АНАЛОГОВЫЕ СИГНАЛЫ" ItemsSource="{Binding mainModel.AnalogGroups}"/>
                        <!--#endregion-->
                        

                      
                    </Menu>
                </Grid>
            </TabItem>
            <!--#endregion-->
            <!--#region События -->
            <TabItem Header="СОБЫТИЯ">
                <TabControl TabStripPlacement="Top">
                    <TabItem Header="ВСЕ СОБЫТИЯ">
                        <Grid>
                            <Grid.Resources>
                                <CollectionViewSource x:Key="EventsCollection" Source="{Binding HistoryEventItems}"/>
                            </Grid.Resources>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <!--#region Панель фильтров -->
                            <Grid Grid.Row="0">
                                <UniformGrid Columns="5">
                                    <uc:DateTimeParameter Description="Начальная точка событий"
                                              DateTimeWidth="200"
                                              Margin="2"
                                              DateTime="{Binding StartPointHistoryEvent, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <uc:DateTimeParameter Description="Конечная точка событий"
                                              DateTimeWidth="200"                                              
                                              Margin="2"
                                              DateTime="{Binding EndPointHistoryEvent, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <Button Margin="2"
                                            VerticalContentAlignment="Center"
                                            Command="{Binding ShowEventsCommand}"
                                           >
                                        <Button.Content>
                                            <StackPanel Orientation="Horizontal">
                                                <fa:ImageAwesome Width="20" 
                                                                 Icon="Refresh" 
                                                                 Foreground="AliceBlue" 
                                                                 Spin="{Binding HistoryItemDownloading}" 
                                                                 Visibility="{Binding HistoryItemDownloading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                <TextBlock Text="Показать" VerticalAlignment="Center"
                                                           HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>
                                    <Border Margin="2" Style="{StaticResource BorderLight}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition/>
                                                <ColumnDefinition Width="0.1*"/>                                                
                                            </Grid.ColumnDefinitions>
                                            <TextBox HorizontalContentAlignment="Left"
                                                     VerticalContentAlignment="Center"
                                                     Text="{Binding EventFilterText, UpdateSourceTrigger=PropertyChanged}"/>
                                            <fa:ImageAwesome Grid.Column="1" Icon="Search" Width="20" Foreground="AliceBlue"/>
                                        </Grid>
                                    </Border>                                    
                                </UniformGrid>
                                
                            </Grid>                            
                            <!--#endregion-->
                            <!--#region Таблица всех событий -->
                            <DataGrid Grid.Row="1" 
                                      IsReadOnly="True" 
                                      AutoGenerateColumns="False" 
                                      ItemsSource="{Binding SelectedEventItems}" 
                                      VirtualizingPanel.VirtualizationMode="Recycling"
                                      CanUserAddRows="False" 
                                      CanUserDeleteRows="False">
                                <DataGrid.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel/>
                                    </ItemsPanelTemplate>
                                </DataGrid.ItemsPanel>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource EventRowStyle}"/>
                                </DataGrid.RowStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Время возникновения ошибки" Binding="{Binding EventTime, StringFormat=F,ConverterCulture=ru-RU}"/>
                                    <DataGridTextColumn Header="Пользователь" Binding="{Binding UserName}"/>
                                    <DataGridTextColumn Header="Код события" Binding="{Binding Event.Num, StringFormat=d4}"/>
                                    <DataGridTextColumn Header="Сообщение" Binding="{Binding Event.Title}"/>
                                    <DataGridTextColumn Header="Активность" Binding="{Binding Activity, Converter={StaticResource StatusFromNum}, ConverterParameter={StaticResource Activities}}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <!--#endregion-->
                        </Grid>
                    </TabItem>
                    <TabItem Header="ОШИБКИ">
                        <ListView ItemsSource="{Binding Events.EventDevices}">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Background" Value="{Binding ActiveBrush}"/>
                                    <Setter Property="Visibility" Value="{Binding IsActive, Converter={StaticResource VisibleConverter}}"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Номер" DisplayMemberBinding="{Binding Num, StringFormat=d4}"/>
                                    <GridViewColumn Header="Сообщение" DisplayMemberBinding="{Binding Title}"/>
                                    <GridViewColumn Header="Время" DisplayMemberBinding="{Binding LastExecDate}"/>
                                    
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </TabItem>
                </TabControl>
                
            </TabItem>
            
            <!--#endregion-->
        </TabControl>
        <Grid.RowDefinitions>
            <RowDefinition Height="0.1*" ></RowDefinition>
            <RowDefinition ></RowDefinition>
        </Grid.RowDefinitions>
        <!--#endregion-->
    </Grid>
    <!--#endregion-->
</Window>
