<UserControl x:Class="IDensity.Core.Views.UserControls.MeasProcesses.Calibration"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:IDensity.ViewModels"
             xmlns:conv="clr-namespace:IDensity.Core.Views.Converters"
             xmlns:p="clr-namespace:IDensity.Core.Views.UserControls.Parameters"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:IDensity.Core.Views.UserControls.MeasProcesses"
             d:DataContext="{d:DesignInstance Type=vm:MeasProcessVm}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid>
        <Grid.Resources>
            <Style TargetType="TextBlock" BasedOn="{StaticResource Common}"/>
            <Style TargetType="DockPanel">
                <Setter Property="MinHeight" Value="50"/>
            </Style>
            <conv:MeasUnitMultiplyConverter x:Key="SingleMultiply"/>
            <conv:GetMeasNumConverter x:Key="SingleMeasPhysValueNum"/>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <ListBox HorizontalContentAlignment="Stretch"  Width="687"                 
                 HorizontalAlignment="Left" 
                 Background="Transparent"
                 BorderThickness="0"
                 VerticalAlignment="Top"
                 ItemContainerStyle="{StaticResource   ParameterListBoxItem}">
            <!--#region Single Meas Time -->
            <DockPanel>
                <TextBlock Text="Время единичного измерения, x0.1 c."/>
                <TextBox Text="{Binding CalibrationVm.SingleMeasTime}" Template="{StaticResource TextBoxTemplate}"
                         Width="165" Height="40" HorizontalAlignment="Right"/>
            </DockPanel>
            <!--#endregion-->
            <!--#region Polynom Deeegre -->
            <DockPanel>
                <TextBlock Text="Степень полинома"/>
                <TextBox Text="{Binding CalibrationVm.PolinomDeg}" Template="{StaticResource TextBoxTemplate}"
                         Width="165" Height="40" HorizontalAlignment="Right"/>
            </DockPanel>
            <!--#endregion-->
            <!--#region Phys value -->
            <DockPanel>
                <TextBlock Text="Физическая величина"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBox Width="80" Template="{StaticResource TextBoxTemplate}" Height="40">
                        <TextBox.Text>
                            <MultiBinding Converter="{StaticResource SingleMultiply}">
                                <Binding Path="CalibrationVm.SingleMeasPhysValue"/>
                                <Binding ElementName="MUnit" Path="SelectedItem"/>
                                <Binding Path="CalibrationVm.MeasUnitMemoryId"/>
                            </MultiBinding>
                        </TextBox.Text>
                    </TextBox>
                    <ComboBox DisplayMemberPath="Name" 
                              Name="MUnit" Width="80"
                              Height="40"
                              Background="Transparent"
                              FontSize="16"
                              Foreground="{Binding RelativeSource={RelativeSource Self}, Path=IsMouseOver, Converter={StaticResource GetIfTrue}, ConverterParameter={StaticResource CompoboxColors}}"
                              Margin="5,0,0,0"
                              VerticalContentAlignment="Center">
                        <!--#region ЕИ -->
                        <ComboBox.ItemsSource>
                            <MultiBinding Converter="{StaticResource SingleMeasPhysValueNum}" Mode="OneWay" >
                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.MeasUnitSettingsVm.MeasUnits"/>
                                <Binding Path="SelectedProcess.MeasType.Value"/>
                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.mainModel.DeviceType.Value"/>
                            </MultiBinding>
                        </ComboBox.ItemsSource>
                        <ComboBox.SelectedItem>
                            <MultiBinding Converter="{StaticResource SingleMeasPhysValueNum}" Mode="OneWay">
                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.MeasUnitSettingsVm.MeasUnits"/>
                                <Binding Path="SelectedProcess.MeasType.Value"/>
                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.mainModel.DeviceType.Value"/>
                                <Binding Path="CalibrationVm.MeasUnitMemoryId"/>
                            </MultiBinding>
                        </ComboBox.SelectedItem>
                        <!--#endregion-->
                    </ComboBox>
                </StackPanel>
            </DockPanel>
            <!--#endregion-->
            <!--#region Single meas results panel -->
            <WrapPanel Orientation="Horizontal">
                <WrapPanel.Resources>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="Aqua"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </WrapPanel.Resources>
                <GroupBox Header="Единичные измерения">
                    <!--#region Данные ед.измерений -->
                    <DataGrid CanUserAddRows="False" 
                                          SelectedIndex="{Binding CalibrationVm.SingleMeasIndex}"
                                          FontSize="16"
                                          FontWeight="Bold"                                          
                                          CanUserDeleteRows="False" 
                                          ItemsSource="{Binding SelectedProcess.SingleMeasResults}"
                                          AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <!--#region № -->
                            <DataGridTextColumn Header="№" MaxWidth="50"
                                                            Binding="{Binding Id}" IsReadOnly="True" />
                            <!--#endregion-->
                            <!--#region Дата измерения-->
                            <DataGridTemplateColumn MaxWidth="140">
                                <DataGridTemplateColumn.Header>
                                    <TextBlock Text="Дата измерения" TextWrapping="Wrap"/>
                                </DataGridTemplateColumn.Header>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <DatePicker DataContext="{Binding Date}" SelectedDate="{Binding WriteValue}">
                                            <i:Interaction.Triggers>
                                                <i:EventTrigger EventName="CalendarClosed">
                                                    <i:InvokeCommandAction Command="{Binding Command}"/>
                                                </i:EventTrigger>
                                            </i:Interaction.Triggers>
                                        </DatePicker>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!--#endregion-->
                            <!--#region Ослабление -->
                            <DataGridTemplateColumn MaxWidth="200"
                                                    Header="Ослабление">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <uc:MenuItemParameterText DataContext="{Binding Weak}" Command="{Binding Command}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!--#endregion-->
                            <!--#region Физическая величина -->
                            <DataGridTemplateColumn>
                                <DataGridTemplateColumn.Header>
                                    <TextBlock Text="Физическая величина" TextWrapping="Wrap"/>
                                </DataGridTemplateColumn.Header>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <uc:MeasUnitTextParameter 
                                                        DataContext="{Binding CounterValue}" 
                                                        Command="{Binding Command}"
                                                        MeasType="{Binding RelativeSource={RelativeSource AncestorType=TabControl}, Path=DataContext.MeasType.Value}"
                                                        MeasUnitMemoryId="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=DataContext.MeasUnitMemoryId}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!--#endregion-->
                            <DataGridCheckBoxColumn Binding="{Binding Selected}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                    <!--#endregion-->
                </GroupBox>
                <GroupBox Header="Расчитанные к-ты полинома" Margin="5,0,0,0">
                    <DataGrid AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          ItemsSource="{Binding CalculatedCoeefs}"
                                          CanUserDeleteRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Cтепень" Binding="{Binding Deg}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Величина" Binding="{Binding Coeff}"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>
            </WrapPanel>
            <!--#endregion-->
        </ListBox>
    </Grid>
</UserControl>
